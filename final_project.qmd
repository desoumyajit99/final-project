---
title: "PSTAT 220A Final Project"
subtitle: "Analysing Poverty"
author: "Soumyajit De"
date: "November 22, 2025"
format: pdf
---

RQ1. How is county-level poverty (percentage of individuals under the poverty level) associated with county demographic, geographic, and socioeconomic characteristics, including gender, race/ethnicity, employment sectors, commuting patterns, employment type, unemployment, education, and average age? Specifically, which of these variables appear to be most strongly associated with poverty, and which (if any) show little or no predictive value?

RQ2: To what extent is county-level poverty associated with the gender composition of the population, and does this association differ between counties in California and Texas?

``` {r}
#list all the libraries
library(tidyverse)
library(colorspace)
library(ggplot2)
```
``` {r}
                                            # load the dataset
pvt_d <- read.csv("poverty_data.csv")

                                            # check for mean, maxima, and minima
summary(pvt_d)

                                        #look for missing values
sum(is.na(pvt_d)) #total number of NAs
colSums(is.na(pvt_d)) #NAs in each variable

                                            #composition check
                            #look into all the variables that have percentages
# set a toleramce of error
tol <- 0.5
                                            #Group: Race
#row-wise sum
pvt_d$race_sum <- pvt_d$Hispanic +
                  pvt_d$White +
                  pvt_d$Black +
                  pvt_d$Native +
                  pvt_d$Asian +
                  pvt_d$Pacific

#does it add up to ~100?
pvt_d$race_ok <- abs(pvt_d$race_sum - 100) <= tol

#see how many rows are ok vs not
table(pvt_d$race_ok, useNA = "ifany")

# the problematic rows
pvt_d[!pvt_d$race_ok & !is.na(pvt_d$race_ok), c("State", "County", "race_sum", "Hispanic", "White", "Black", "Native", "Asian", "Pacific")]

                                            #Group:  Employment sectors
#row-wise sum
pvt_d$sector_sum <- pvt_d$Professional +
                    pvt_d$Service +
                    pvt_d$Office +
                    pvt_d$Construction +
                    pvt_d$Production

#does it add up to ~100?
pvt_d$sector_ok <- abs(pvt_d$sector_sum - 100) <= tol

#see how many rows are ok vs not
table(pvt_d$sector_ok, useNA = "ifany")

# the problematic rows
pvt_d[!pvt_d$sector_ok & !is.na(pvt_d$sector_ok), c("State", "County", "sector_sum","Professional", "Service", "Office", "Construction", "Production")]

                                            #Group: Transportation
#row-wise sum
pvt_d$transport_sum <- pvt_d$Drive +
                       pvt_d$Carpool +
                       pvt_d$Transit +
                       pvt_d$Walk +
                       pvt_d$OtherTransp +
                       pvt_d$WorkAtHome

#does it add up to ~100?
pvt_d$transport_ok <- abs(pvt_d$transport_sum - 100) <= tol

#see how many rows are ok vs not
table(pvt_d$transport_ok, useNA = "ifany")

# the problematic rows
pvt_d[!pvt_d$transport_ok & !is.na(pvt_d$transport_ok), c("State", "County", "transport_sum", "Drive", "Carpool", "Transit", "Walk", "OtherTransp", "WorkAtHome")]

                                            #Group: Type of work / employer
#row-wise sum
pvt_d$worktype_sum <- pvt_d$PrivateWork +
                      pvt_d$PublicWork +
                      pvt_d$SelfEmployed +
                      pvt_d$FamilyWork

#does it add up to ~100?
pvt_d$worktype_ok <- abs(pvt_d$worktype_sum - 100) <= tol

#see how many rows are ok vs not
table(pvt_d$worktype_ok, useNA = "ifany")

# the problematic rows
pvt_d[!pvt_d$worktype_ok & !is.na(pvt_d$worktype_ok), c("State", "County", "worktype_sum", "PrivateWork", "PublicWork", "SelfEmployed", "FamilyWork")]

                                            #Group: Education
#row-wise sum
pvt_d$educ_sum <- pvt_d$LessThanHighSchool +
                  pvt_d$HighSchoolDiploma +
                  pvt_d$SomeCollegeOrAssociateDegree +
                  pvt_d$BachelorDegreeOrHigher

#does it add up to ~100?
pvt_d$educ_ok <- ifelse(is.na(pvt_d$educ_sum), NA, abs(pvt_d$educ_sum - 100) <= tol)

#see how many rows are ok vs not
table(pvt_d$educ_ok, useNA = "ifany")

# the problematic rows
pvt_d[!pvt_d$educ_ok & !is.na(pvt_d$educ_ok),
      c("State", "County", "educ_sum",
        "LessThanHighSchool", "HighSchoolDiploma",
        "SomeCollegeOrAssociateDegree", "BachelorDegreeOrHigher")]

# 8 missing rows
# Indices of the 8 counties with missing education data
idx_educ_na <- which(is.na(pvt_d$educ_ok))

# See their state + county names
pvt_d[idx_educ_na, c("State", "County")]

sum(is.na(pvt_d)) #total number of NAs
colSums(is.na(pvt_d)) #NAs in each variable

# see all the NAs
na_rows <- pvt_d[rowSums(is.na(pvt_d)) > 0, ]

```

```{r}
#once again summary statistics
summary(pvt_d)

                              #start plotting
                            # visualize the outcome variable first


#box plot of poverty by state
pov_bp <- pvt_d %>%
          ggplot(aes(x = State, y = Poverty)) +
          geom_boxplot(aes(fill = State)) +
          scale_fill_discrete_qualitative() +
          labs(title = "Poverty by State", x = "State", y = "Poverty (%)")


#density plot of poverty
pov_dp <- pvt_d %>%
          ggplot(aes(x = Poverty)) +
          geom_density(alpha = 0.3, fill = "#08306B") +
          labs(title = "Density of County Poverty Rates", x = "Poverty (%)", y = "Density") +
          theme_bw()


          
                            #economic and education variables

#make a vector of those variables (make it easier for faceting)
econ_educ_vars <- c("Unemployment","LessThanHighSchool","HighSchoolDiploma","SomeCollegeOrAssociateDegree","BachelorDegreeOrHigher","AvgAge","MeanCommute")


#density plot of economic and educational variables
econ_edu_dp <- pvt_d %>%
                          pivot_longer(all_of(econ_educ_vars), names_to = "Variable", values_to = "Value") %>%
                          ggplot(aes(x = Value)) +
                          geom_density(alpha = 0.3, fill = "#08306B") +
                          facet_wrap(~ Variable, scales = "free") +
                          labs(title = "Distributions: Economic & Education Variables", x = "Percentage", y = "Density") +
                          theme_bw()



#poverty vs unemployment
ue_pvt_sc <- pvt_d %>%
                      ggplot(aes(x = Unemployment, y = Poverty)) +
                      geom_point(alpha = 0.3, color = "#08306B") +
                      geom_smooth(method = "loess", se = FALSE, color = "black") +
                      labs(title = "Poverty vs Unemployment", x = "Unemployment (%)", y = "Poverty (%)") +
                      theme_bw()



#poverty vs each education 
educ_vars <- c("LessThanHighSchool","HighSchoolDiploma", "SomeCollegeOrAssociateDegree","BachelorDegreeOrHigher")

ed_pvt_sc <- pvt_d %>%
                      pivot_longer(all_of(educ_vars), names_to = "Education",values_to = "EduPercent") %>%
                      ggplot(aes(x = EduPercent, y = Poverty)) +
                      geom_point(alpha = 0.3, color = "#08306B", size = 0.5) +
                      geom_smooth(method = "loess", se = FALSE, color = "black") +
                      facet_wrap(~ Education, scales = "free_x") +
                      labs(title = "Poverty vs Education Composition", x = "Education category (%)", y = "Poverty (%)") +
                      theme_bw()


#poverty vs average age and mean commute
age_commute_vars <- c("AvgAge", "MeanCommute")

agmc_pvt_sc <- pvt_d %>%
                        pivot_longer(all_of(age_commute_vars), names_to = "Variable", values_to = "Value") %>%
                        ggplot(aes(x = Value, y = Poverty)) +
                        geom_point(alpha = 0.3, color = "#08306B") +
                        geom_smooth(method = "loess", se = FALSE, color = "black") +
                        facet_wrap(~ Variable, scales = "free_x") +
                        labs(title = "Poverty vs Average Age and Mean Commute", x = NULL, y = "Poverty (%)") +
                        theme_bw()



                                #gender race and ethnicity

#create proportion women 
pvt_d <- pvt_d %>% mutate(propWomen = 100 * Women / TotalPop)

# histogram proportion women 
hg_pw <- pvt_d %>% 
                  ggplot(aes(x = propWomen)) +
                  geom_histogram(bins = 30, fill = "#08306B", color = "black") +
                  labs(title = "Distribution of Proportion Women", x = "Women (%)", y = "Number of Counties") +
                  theme_bw()


# poverty vs proportion women
wm_pvt_sc <- pvt_d %>% 
                        ggplot (aes(x = propWomen, y = Poverty)) +
                        geom_point(alpha = 0.3, color = "#08306B") +
                        geom_smooth(method = "loess", se = FALSE, color = "black") +
                        scale_color_continuous_sequential() +
                        labs(title = "Poverty vs Proportion Women", x = "Women (%)", y = "Poverty (%)") +
                        theme_bw()



# create race/ethnicity vector
race_vars <- c("Hispanic", "White", "Black", "Native", "Asian", "Pacific")

# race/ethnicity histogram

re_hist <- pvt_d %>%
                    pivot_longer(all_of(race_vars), names_to = "Race",values_to = "Percent") %>%
                    ggplot(aes(x = Percent)) +
                    geom_histogram(bins = 30, fill = "#08306B", color = "black") +
                    facet_wrap(~ Race, scales = "free") +
                    labs(title = "Distributions: Race/Ethnicity Percentages",  x = "Percent", y = "Number of Counties") +
                    theme_bw()


# poverty vs race 
pr_pvt_sc <- pvt_d %>%
                      pivot_longer(all_of(race_vars), names_to = "Race", values_to = "Percent") %>%
                      ggplot(aes(x = Percent, y = Poverty)) +
                      geom_point(alpha = 0.3, color = "#08306B") +
                      geom_smooth(method = "loess", se = FALSE, color = "black") +
                      facet_wrap(~ Race, scales = "free_x") +
                      labs(title = "Poverty vs Race/Ethnicity Composition", x = "Percent in group (%)", y = "Poverty (%)") +
                      theme_bw()



                                                        # filter to ca and tx, poverty vs propwomen colored by state
catx_pvt_sc <- pvt_d %>%
                        filter(State %in% c("CA", "TX")) %>%
                        ggplot(aes(x = propWomen, y = Poverty, color = State)) +
                        geom_point(alpha = 0.5) +
                        geom_smooth(method = "lm", se = FALSE) +
                        scale_color_discrete_qualitative() +
                        labs(title = "Poverty vs Proportion Women in CA vs TX", x = "Women (%)", y = "Poverty (%)") +
                        theme_bw()



                                                                          #employment sectors

sector_vars <- c("Professional", "Service", "Office", "Construction", "Production")

#histograms of employment sectors
eps_hist <- pvt_d %>%
                      pivot_longer(all_of(sector_vars), names_to = "Sector",values_to = "Percent") %>%
                      ggplot(aes(x = Percent)) +
                      geom_histogram(bins = 30, fill = "#08306B", color = "black") +
                      facet_wrap(~ Sector, scales = "free") +
                      labs(title = "Distributions: Employment Sectors", x = "Percent in sector (%)", y = "Number of Counties") + 
                      theme_bw()


#poverty vs employment
pe_pvt_sc <- pvt_d %>%
                    pivot_longer(all_of(sector_vars), names_to = "Sector", values_to = "Percent") %>%
                    ggplot(aes(x = Percent, y = Poverty)) +
                    geom_point(alpha = 0.3, color = "#08306B", size = 0.5) +
                    geom_smooth(method = "loess", se = FALSE, color = "black") +
                    facet_wrap(~ Sector, scales = "free_x") +
                    labs(title = "Poverty vs Employment Sectors", x = "Percent in sector (%)", y = "Poverty (%)") + 
                    theme_bw()


                        #transportation and work types

#create transportation and worktyoe vectors
transport_vars <- c("Drive", "Carpool", "Transit", "Walk", "OtherTransp", "WorkAtHome")
worktype_vars  <- c("PrivateWork", "PublicWork", "SelfEmployed", "FamilyWork")

#transport histograms
ts_hist <- pvt_d %>%
                    pivot_longer(all_of(transport_vars), names_to = "Mode", values_to = "Percent") %>%
                    ggplot(aes(x = Percent)) +
                    geom_histogram(bins = 30, fill = "#08306B", color = "black") +
                    facet_wrap(~ Mode, scales = "free") +
                    labs(title = "Distributions: Commuting Modes", x = "Percent using mode (%)", y = "Number of Counties") +
                    theme_bw()



#poverty vs transportation
ts_pvt_sc <- pvt_d %>%
                      pivot_longer(all_of(transport_vars), names_to = "Mode", values_to = "Percent") %>%
                      ggplot(aes(x = Percent, y = Poverty)) +
                      geom_point(alpha = 0.3, color = "#08306B", size = 0.5) +
                      geom_smooth(method = "loess", se = FALSE, color = "black") +
                      facet_wrap(~ Mode, scales = "free_x") +
                      labs(title = "Poverty vs Commuting Modes", x = "Percent using mode (%)", y = "Poverty (%)") +
                      theme_bw()


#work type histograms
wt_hist <- pvt_d %>% pivot_longer(all_of(worktype_vars), names_to = "WorkType", values_to = "Percent") %>%
                     ggplot(aes(x = Percent)) +
                     geom_histogram(bins = 30, fill = "#08306B", color = "black") +
                     facet_wrap(~ WorkType, scales = "free") +
                     labs(title = "Distributions: Work Types", x = "Percent in work type (%)", y = "Number of Counties") +
                     theme_bw()



# poverty vs work type
wt_pvt_sc <- pvt_d %>%
                      pivot_longer(all_of(worktype_vars), names_to = "WorkType", values_to = "Percent") %>%
                      ggplot(aes(x = Percent, y = Poverty)) +
                      geom_point(alpha = 0.3, color = "#08306B", size = 0.5) +
                      geom_smooth(method = "loess", se = FALSE, color = "black") +
                      facet_wrap(~ WorkType, scales = "free_x") +
                      labs(title = "Poverty vs Work Types", x = "Percent in work type (%)", y = "Poverty (%)") +
                      theme_bw()


                                  #geography

#spatial scatter lat vs long colored by poverty
ss_pvt_ss <- pvt_d %>%
                      ggplot(aes(x = Long, y = Lat, color = Poverty)) +
                      geom_point(alpha = 0.8) +
                      labs(title = "Geographic Distribution of Poverty", x = "Longitude", y = "Latitude") +
                      theme_bw()



#totalpop histogram
pop_hist <- pvt_d %>%
                      ggplot(aes(x = TotalPop)) +
                      geom_histogram(bins = 30, fill = "#08306B", color = "black") + 
                      labs(title = "Distribution of County Population Size", x = "Total population", y = "Number of Counties") +
                      theme_bw() 


# poverty vs totalpop 
pop_pvt_ss <- pvt_d %>% 
                        ggplot(aes(x = TotalPop, y = Poverty)) +
                        geom_point(alpha = 0.3, color = "#08306B", size = 0.5) +
                        labs(title = "Poverty vs Population Size", x = "Total population", y = "Poverty (%)") +
                        theme_bw()

ggsave("poverty_vs_population.png", plot = pop_pvt_ss, width = 10, height = 10, dpi = 300)

#1
pov_bp
pov_dp

#2
econ_edu_hist
ue_pvt_sc

#3 
ed_pvt_sc
agmc_pvt_sc

#4
hg_pw
wm_pvt_sc

#5
re_hist
pr_pvt_sc

#6
catx_pvt_sc

#7
eps_hist

#8
ts_hist
ts_pvt_sc

#9
wt_hist
wt_pvt_sc

#10
geo_pvt_hist
ss_pvt_ss

#11
pop_hist
pop_pvt_ss
```