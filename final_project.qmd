---
title: "PSTAT 220A Final Project"
subtitle: "Analysing Poverty"
author: "Soumyajit De"
date: "November 22, 2025"
format: pdf
---

RQ1. How is county-level poverty (percentage of individuals under the poverty level) associated with county demographic, geographic, and socioeconomic characteristics, including gender, race/ethnicity, employment sectors, commuting patterns, employment type, unemployment, education, and average age? Specifically, which of these variables appear to be most strongly associated with poverty, and which (if any) show little or no predictive value?

RQ2: To what extent is county-level poverty associated with the gender composition of the population, and does this association differ between counties in California and Texas?

``` {r}
#list all the libraries
library(tidyverse)
library(colorspace)
library(ggplot2)
library(dplyr)
library(apaTables)
library(broom)
library(lindia)
library(sandwich)
library(lmtest)
library(knitr)
```
``` {r}
                                            # load the dataset
pvt_d <- read.csv("poverty_data.csv")

                                            # check for mean, maxima, and minima
summary(pvt_d)

                                        #look for missing values
sum(is.na(pvt_d)) #total number of NAs
colSums(is.na(pvt_d)) #NAs in each variable

                                            #composition check
                            #look into all the variables that have percentages
# set a toleramce of error
tol <- 0.5
                                            #Group: Race
#row-wise sum
pvt_d$race_sum <- pvt_d$Hispanic +
                  pvt_d$White +
                  pvt_d$Black +
                  pvt_d$Native +
                  pvt_d$Asian +
                  pvt_d$Pacific

#does it add up to ~100?
pvt_d$race_ok <- abs(pvt_d$race_sum - 100) <= tol

#see how many rows are ok vs not
table(pvt_d$race_ok, useNA = "ifany")

# the problematic rows
pvt_d[!pvt_d$race_ok & !is.na(pvt_d$race_ok), c("State", "County", "race_sum", "Hispanic", "White", "Black", "Native", "Asian", "Pacific")]

                                            #Group:  Employment sectors
#row-wise sum
pvt_d$sector_sum <- pvt_d$Professional +
                    pvt_d$Service +
                    pvt_d$Office +
                    pvt_d$Construction +
                    pvt_d$Production

#does it add up to ~100?
pvt_d$sector_ok <- abs(pvt_d$sector_sum - 100) <= tol

#see how many rows are ok vs not
table(pvt_d$sector_ok, useNA = "ifany")

# the problematic rows
pvt_d[!pvt_d$sector_ok & !is.na(pvt_d$sector_ok), c("State", "County", "sector_sum","Professional", "Service", "Office", "Construction", "Production")]

                                            #Group: Transportation
#row-wise sum
pvt_d$transport_sum <- pvt_d$Drive +
                       pvt_d$Carpool +
                       pvt_d$Transit +
                       pvt_d$Walk +
                       pvt_d$OtherTransp +
                       pvt_d$WorkAtHome

#does it add up to ~100?
pvt_d$transport_ok <- abs(pvt_d$transport_sum - 100) <= tol

#see how many rows are ok vs not
table(pvt_d$transport_ok, useNA = "ifany")

# the problematic rows
pvt_d[!pvt_d$transport_ok & !is.na(pvt_d$transport_ok), c("State", "County", "transport_sum", "Drive", "Carpool", "Transit", "Walk", "OtherTransp", "WorkAtHome")]

                                            #Group: Type of work / employer
#row-wise sum
pvt_d$worktype_sum <- pvt_d$PrivateWork +
                      pvt_d$PublicWork +
                      pvt_d$SelfEmployed +
                      pvt_d$FamilyWork

#does it add up to ~100?
pvt_d$worktype_ok <- abs(pvt_d$worktype_sum - 100) <= tol

#see how many rows are ok vs not
table(pvt_d$worktype_ok, useNA = "ifany")

# the problematic rows
pvt_d[!pvt_d$worktype_ok & !is.na(pvt_d$worktype_ok), c("State", "County", "worktype_sum", "PrivateWork", "PublicWork", "SelfEmployed", "FamilyWork")]

                                            #Group: Education
#row-wise sum
pvt_d$educ_sum <- pvt_d$LessThanHighSchool +
                  pvt_d$HighSchoolDiploma +
                  pvt_d$SomeCollegeOrAssociateDegree +
                  pvt_d$BachelorDegreeOrHigher

#does it add up to ~100?
pvt_d$educ_ok <- ifelse(is.na(pvt_d$educ_sum), NA, abs(pvt_d$educ_sum - 100) <= tol)

#see how many rows are ok vs not
table(pvt_d$educ_ok, useNA = "ifany")

# the problematic rows
pvt_d[!pvt_d$educ_ok & !is.na(pvt_d$educ_ok),
      c("State", "County", "educ_sum",
        "LessThanHighSchool", "HighSchoolDiploma",
        "SomeCollegeOrAssociateDegree", "BachelorDegreeOrHigher")]

# 8 missing rows
# Indices of the 8 counties with missing education data
idx_educ_na <- which(is.na(pvt_d$educ_ok))

# See their state + county names
pvt_d[idx_educ_na, c("State", "County")]

sum(is.na(pvt_d)) #total number of NAs
colSums(is.na(pvt_d)) #NAs in each variable

# see all the NAs
na_rows <- pvt_d[rowSums(is.na(pvt_d)) > 0, ]

```

```{r}
#once again summary statistics
summary(pvt_d)

                              #start plotting
                            # visualize the outcome variable first


#box plot of poverty by state
pov_bp <- pvt_d %>%
          ggplot(aes(x = State, y = Poverty)) +
          geom_boxplot(aes(fill = State)) +
          scale_fill_discrete_qualitative() +
          labs(title = "Poverty by State", x = "State", y = "Poverty (%)")


#density plot of poverty
pov_dp <- pvt_d %>%
          ggplot(aes(x = Poverty)) +
          geom_density(alpha = 0.3, fill = "#08306B") +
          labs(title = "Density of County Poverty Rates", x = "Poverty (%)", y = "Density") +
          theme_bw()


          
                            #economic and education variables

#make a vector of those variables (make it easier for faceting)
econ_educ_vars <- c("Unemployment","LessThanHighSchool","HighSchoolDiploma","SomeCollegeOrAssociateDegree","BachelorDegreeOrHigher","AvgAge","MeanCommute")


#density plot of economic and educational variables
econ_edu_dp <- pvt_d %>%
                          pivot_longer(all_of(econ_educ_vars), names_to = "Variable", values_to = "Value") %>%
                          ggplot(aes(x = Value)) +
                          geom_density(alpha = 0.3, fill = "#08306B") +
                          facet_wrap(~ Variable, scales = "free") +
                          labs(title = "Distributions: Economic & Education Variables", x = "Percentage", y = "Density") +
                          theme_bw()



#poverty vs unemployment
ue_pvt_sc <- pvt_d %>%
                      ggplot(aes(x = Unemployment, y = Poverty)) +
                      geom_point(alpha = 0.3, color = "#08306B") +
                      geom_smooth(method = "loess", se = FALSE, color = "black") +
                      labs(title = "Poverty vs Unemployment", x = "Unemployment (%)", y = "Poverty (%)") +
                      theme_bw()



#poverty vs each education 
educ_vars <- c("LessThanHighSchool","HighSchoolDiploma", "SomeCollegeOrAssociateDegree","BachelorDegreeOrHigher")

ed_pvt_sc <- pvt_d %>%
                      pivot_longer(all_of(educ_vars), names_to = "Education",values_to = "EduPercent") %>%
                      ggplot(aes(x = EduPercent, y = Poverty)) +
                      geom_point(alpha = 0.3, color = "#08306B", size = 0.5) +
                      geom_smooth(method = "loess", se = FALSE, color = "black") +
                      facet_wrap(~ Education, scales = "free_x") +
                      labs(title = "Poverty vs Education Composition", x = "Education category (%)", y = "Poverty (%)") +
                      theme_bw()


#poverty vs average age and mean commute
age_commute_vars <- c("AvgAge", "MeanCommute")

agmc_pvt_sc <- pvt_d %>%
                        pivot_longer(all_of(age_commute_vars), names_to = "Variable", values_to = "Value") %>%
                        ggplot(aes(x = Value, y = Poverty)) +
                        geom_point(alpha = 0.3, color = "#08306B") +
                        geom_smooth(method = "loess", se = FALSE, color = "black") +
                        facet_wrap(~ Variable, scales = "free_x") +
                        labs(title = "Poverty vs Average Age and Mean Commute", x = NULL, y = "Poverty (%)") +
                        theme_bw()



                                #gender race and ethnicity

#create proportion women 
pvt_d <- pvt_d %>% mutate(propWomen = 100 * Women / TotalPop)

# histogram proportion women 
hg_pw <- pvt_d %>% 
                  ggplot(aes(x = propWomen)) +
                  geom_histogram(bins = 30, fill = "#08306B", color = "black") +
                  labs(title = "Distribution of Proportion Women", x = "Women (%)", y = "Number of Counties") +
                  theme_bw()


# poverty vs proportion women
wm_pvt_sc <- pvt_d %>% 
                        ggplot (aes(x = propWomen, y = Poverty)) +
                        geom_point(alpha = 0.3, color = "#08306B") +
                        geom_smooth(method = "loess", se = FALSE, color = "black") +
                        scale_color_continuous_sequential() +
                        labs(title = "Poverty vs Proportion Women", x = "Women (%)", y = "Poverty (%)") +
                        theme_bw()



# create race/ethnicity vector
race_vars <- c("Hispanic", "White", "Black", "Native", "Asian", "Pacific")

# race/ethnicity histogram

re_hist <- pvt_d %>%
                    pivot_longer(all_of(race_vars), names_to = "Race",values_to = "Percent") %>%
                    ggplot(aes(x = Percent)) +
                    geom_histogram(bins = 30, fill = "#08306B", color = "black") +
                    facet_wrap(~ Race, scales = "free") +
                    labs(title = "Distributions: Race/Ethnicity Percentages",  x = "Percent", y = "Number of Counties") +
                    theme_bw()


# poverty vs race 
pr_pvt_sc <- pvt_d %>%
                      pivot_longer(all_of(race_vars), names_to = "Race", values_to = "Percent") %>%
                      ggplot(aes(x = Percent, y = Poverty)) +
                      geom_point(alpha = 0.3, color = "#08306B") +
                      geom_smooth(method = "loess", se = FALSE, color = "black") +
                      facet_wrap(~ Race, scales = "free_x") +
                      labs(title = "Poverty vs Race/Ethnicity Composition", x = "Percent in group (%)", y = "Poverty (%)") +
                      theme_bw()



                                                        # filter to ca and tx, poverty vs propwomen colored by state
catx_pvt_sc <- pvt_d %>%
                        filter(State %in% c("CA", "TX")) %>%
                        ggplot(aes(x = propWomen, y = Poverty, color = State)) +
                        geom_point(alpha = 0.5) +
                        geom_smooth(method = "lm", se = FALSE) +
                        scale_color_discrete_qualitative() +
                        labs(title = "Poverty vs Proportion Women in CA vs TX", x = "Women (%)", y = "Poverty (%)") +
                        theme_bw()



                                                                          #employment sectors

sector_vars <- c("Professional", "Service", "Office", "Construction", "Production")

#histograms of employment sectors
eps_hist <- pvt_d %>%
                      pivot_longer(all_of(sector_vars), names_to = "Sector",values_to = "Percent") %>%
                      ggplot(aes(x = Percent)) +
                      geom_histogram(bins = 30, fill = "#08306B", color = "black") +
                      facet_wrap(~ Sector, scales = "free") +
                      labs(title = "Distributions: Employment Sectors", x = "Percent in sector (%)", y = "Number of Counties") + 
                      theme_bw()


#poverty vs employment
pe_pvt_sc <- pvt_d %>%
                    pivot_longer(all_of(sector_vars), names_to = "Sector", values_to = "Percent") %>%
                    ggplot(aes(x = Percent, y = Poverty)) +
                    geom_point(alpha = 0.3, color = "#08306B", size = 0.5) +
                    geom_smooth(method = "loess", se = FALSE, color = "black") +
                    facet_wrap(~ Sector, scales = "free_x") +
                    labs(title = "Poverty vs Employment Sectors", x = "Percent in sector (%)", y = "Poverty (%)") + 
                    theme_bw()


                        #transportation and work types

#create transportation and worktyoe vectors
transport_vars <- c("Drive", "Carpool", "Transit", "Walk", "OtherTransp", "WorkAtHome")
worktype_vars  <- c("PrivateWork", "PublicWork", "SelfEmployed", "FamilyWork")

#transport histograms
ts_hist <- pvt_d %>%
                    pivot_longer(all_of(transport_vars), names_to = "Mode", values_to = "Percent") %>%
                    ggplot(aes(x = Percent)) +
                    geom_histogram(bins = 30, fill = "#08306B", color = "black") +
                    facet_wrap(~ Mode, scales = "free") +
                    labs(title = "Distributions: Commuting Modes", x = "Percent using mode (%)", y = "Number of Counties") +
                    theme_bw()



#poverty vs transportation
ts_pvt_sc <- pvt_d %>%
                      pivot_longer(all_of(transport_vars), names_to = "Mode", values_to = "Percent") %>%
                      ggplot(aes(x = Percent, y = Poverty)) +
                      geom_point(alpha = 0.3, color = "#08306B", size = 0.5) +
                      geom_smooth(method = "loess", se = FALSE, color = "black") +
                      facet_wrap(~ Mode, scales = "free_x") +
                      labs(title = "Poverty vs Commuting Modes", x = "Percent using mode (%)", y = "Poverty (%)") +
                      theme_bw()


#work type histograms
wt_hist <- pvt_d %>% pivot_longer(all_of(worktype_vars), names_to = "WorkType", values_to = "Percent") %>%
                     ggplot(aes(x = Percent)) +
                     geom_histogram(bins = 30, fill = "#08306B", color = "black") +
                     facet_wrap(~ WorkType, scales = "free") +
                     labs(title = "Distributions: Work Types", x = "Percent in work type (%)", y = "Number of Counties") +
                     theme_bw()



# poverty vs work type
wt_pvt_sc <- pvt_d %>%
                      pivot_longer(all_of(worktype_vars), names_to = "WorkType", values_to = "Percent") %>%
                      ggplot(aes(x = Percent, y = Poverty)) +
                      geom_point(alpha = 0.3, color = "#08306B", size = 0.5) +
                      geom_smooth(method = "loess", se = FALSE, color = "black") +
                      facet_wrap(~ WorkType, scales = "free_x") +
                      labs(title = "Poverty vs Work Types", x = "Percent in work type (%)", y = "Poverty (%)") +
                      theme_bw()

ggsave("poverty_vs_worktype.png", plot = pop_pvt_ss, width = 10, height = 10, dpi = 300)

                                  #geography

#spatial scatter lat vs long colored by poverty
ss_pvt_ss <- pvt_d %>%
                      ggplot(aes(x = Long, y = Lat, color = Poverty)) +
                      geom_point(alpha = 0.8) +
                      labs(title = "Geographic Distribution of Poverty", x = "Longitude", y = "Latitude") +
                      theme_bw()



#totalpop histogram
pop_hist <- pvt_d %>%
                      ggplot(aes(x = TotalPop)) +
                      geom_histogram(bins = 30, fill = "#08306B", color = "black") + 
                      labs(title = "Distribution of County Population Size", x = "Total population", y = "Number of Counties") +
                      theme_bw() 


# poverty vs totalpop 
pop_pvt_ss <- pvt_d %>% 
                        ggplot(aes(x = TotalPop, y = Poverty)) +
                        geom_point(alpha = 0.3, color = "#08306B", size = 0.5) +
                        labs(title = "Poverty vs Population Size", x = "Total population", y = "Poverty (%)") +
                        theme_bw()

```

```{r}

#fit the model including everything first

pvt_lm <- lm(Poverty ~ TotalPop + propWomen + Hispanic + Black + Native +  Asian + Pacific + Service + Office + Construction + Production + Carpool + Transit + Walk + OtherTransp + WorkAtHome + MeanCommute + PublicWork + SelfEmployed + FamilyWork + Unemployment + HighSchoolDiploma + SomeCollegeOrAssociateDegree + BachelorDegreeOrHigher + AvgAge + Long + Lat, data = pvt_d, na.action = na.omit)

table1 <- apa.reg.table(pvt_lm, table.number = 1,filename = "OLS.doc")

apa.save(filename = "OLS.doc", table1)
```

```{r}
#homoskedasticity
#residual vs fitted plot for the entire fitted model
diag_df <- broom::augment(pvt_lm)  

diag_df <- broom::augment(pvt_lm) %>%
                              mutate(row = as.integer(.rownames)) %>% 
                              left_join(pvt_d %>% mutate(row = dplyr::row_number()), by = "row")

lm_rf <- diag_df %>%
                    ggplot(aes(x = .fitted, y = .resid)) +
                    geom_hline(yintercept = 0, linetype = "dashed") +
                    geom_point(alpha = 0.4, size = 1) +
                    geom_smooth(method = "lm", se = FALSE) +
                    labs(x = "Fitted values (Predicted Poverty %)", y = "Residuals", title = "Residuals vs Fitted Values for Main Model") +
                    theme_bw() 

ggsave("resfit_lm.png", plot = lm_rf, width = 10, height = 10, dpi = 300)



#normality of residuals

#histogram
norm_res_hist <- diag_df %>% 
                            ggplot(aes(x = .resid)) +
                            geom_histogram(fill = "#08306B") +
                            labs(x = "Residuals", y = "Count", title = "Histogram of residuals for model") +
                            theme_bw()

ggsave("norm_res_hist.png", plot = norm_res_hist, width = 10, height = 10, dpi = 300)

#QQ plot
norm_res_qq <- diag_df %>%
                        ggplot(aes(sample = .resid)) +
                        stat_qq() +
                        stat_qq_line() +
                        labs(x = "Theoretical quantiles", y = "Sample quantiles (standardized residuals)", title = "Normal Qâ€“Q plot of residuals") +
                        theme_bw()

ggsave("norm_res_qq.png", plot = norm_res_qq, width = 10, height = 10, dpi = 300)

#residual correlation
#residual scatterplot by latlong
resid_cor_latlong <- diag_df %>%
                        ggplot(aes(x = Long, y = Lat, color = .resid)) +
                        geom_point() +
                        scale_colour_continuous_divergingx(palette = "RdBu", mid = 0) +
                        coord_fixed(1.3) +
                        labs(x = "Longitude", y = "Latitude", color = "Residual", title = "Spatial pattern of residuals from model") +
                        theme_bw()

ggsave("resid_cor_latlong.png", plot = resid_cor_latlong, width = 10, height = 10, dpi = 300)

#residual boxplot per state
resid_cor_state <- diag_df %>%
                              ggplot(aes(x = State, y = .resid)) +
                              geom_boxplot(outlier.alpha = 0.2) +
                              geom_hline(yintercept = 0, linetype = "dashed") +
                              labs(x = "State", y = "Residuals", title = "Residuals by state") +
                              theme_bw() +
                              theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

ggsave("resid_cor_state.png", plot = resid_cor_state, width = 10, height = 10, dpi = 300)

#outliers

#plots
diag_plots <- gg_diagnose(diag_df, plot.all = FALSE)
names(diag_plots)

diag_plots$resleverage
diag_plots$cooksd

ggsave("reslevarage_outliers.png", plot = diag_plots$resleverage, width = 10, height = 10, dpi = 300)

ggsave("cooksd_outliers.png", plot = diag_plots$cooksd, width = 10, height = 10, dpi = 300)

# how many big standardized residuals?
sum(abs(diag_df$.std.resid) > 2)
sum(abs(diag_df$.std.resid) > 3)

# Cook's distance cutoff & how many above
n <- nrow(diag_df)
p <- length(coef(pvt_lm))
cook_cut <- 4 / (n - p - 1)

sum(diag_df$.cooksd > cook_cut)

#colinearity
vif(pvt_lm)

```

```{r}
#use robust standard errors

#compute a robust covariate matrix
vcov_robust <- vcovHC(pvt_lm, type = "HC3")

#get robust coefficients test
robust_ct <- coeftest(pvt_lm, vcov. = vcov_robust)

#turn it into tidy dataframe
robust_tidy <- broom::tidy(pvt_lm)      
robust_se   <- sqrt(diag(vcov_robust)) 

# Replace the SE, t, p in the tidy table
robust_tidy$std.error <- robust_se
robust_tidy$statistic <- robust_tidy$estimate / robust_tidy$std.error
robust_tidy$p.value   <- 2 * pt(abs(robust_tidy$statistic), df = df.residual(pvt_lm), lower.tail = FALSE)

#add 95% CI
alpha <- 0.05
t_crit <- qt(1 - alpha/2, df = df.residual(pvt_lm))

robust_tidy$conf.low  <- robust_tidy$estimate - t_crit * robust_tidy$std.error
robust_tidy$conf.high <- robust_tidy$estimate + t_crit * robust_tidy$std.error

#use this for reporting
knitr::kable(robust_tidy, digits = 3)

table2 <- apa.reg.table(robust_tidy, table.number = 1, filename = "regression_robust_se.doc")
apa.save(filename = "regression_robust_se.doc", robust_tidy)

```
```{r}
#multiple testing

#define the family of hypotheses for RQ1: socio-demographic + economic predictors, TotalPop, Long, Lat as controls

rq1_family <- c("propWomen", "Hispanic", "Black", "Native", "Asian", "Pacific", "Service", "Office", "Construction", "Production", "Carpool", "Transit", "Walk", "OtherTransp", "WorkAtHome", "PublicWork", "SelfEmployed", "FamilyWork", "Unemployment", "HighSchoolDiploma", "SomeCollegeOrAssociateDegree", "BachelorDegreeOrHigher", "AvgAge", "MeanCommute")


rq1_results <- robust_tidy %>%
                              dplyr::filter(term %in% rq1_family)

#apply BH method to calculate FDR

rq1_results <- rq1_results %>%
                            dplyr::mutate(p_raw = p.value, p_BH  = p.adjust(p.value, method = "BH"), sig_BH_05 = p_BH < 0.05)

rq1_results[order(rq1_results$p_BH), ]

subset(rq1_results, sig_BH_05)
subset(rq1_results, !sig_BH_05)



```

```{r}
#RQ2 CA vs TX

#subset to CA and TX
pvt_catx <- pvt_d %>%
                      filter(State %in% c("CA", "TX")) %>%
                                                          droplevels()

#set CA as reference
pvt_catx$State <- relevel(factor(pvt_catx$State), ref = "CA")

#mean center propWomen for nicer interpretation
pvt_catx <- pvt_catx %>%
                        mutate(propWomen_c = propWomen - mean(propWomen, na.rm = TRUE))

#fit the model for RQ2 (with interaction: propwomen_c * state)
rq2_lm <- lm(Poverty ~ propWomen_c * State + Unemployment + HighSchoolDiploma + SomeCollegeOrAssociateDegree + BachelorDegreeOrHigher + Hispanic + Black + Native + Asian + Pacific, data = pvt_catx, na.action = na.omit)


# Robust SEs for RQ2 model

vcov_robust_rq2 <- vcovHC(rq2_lm, type = "HC3")
rq2_ct <- coeftest(rq2_lm, vcov. = vcov_robust_rq2)

rq2_tidy <- broom::tidy(rq2_lm)
rq2_se <- sqrt(diag(vcov_robust_rq2))

rq2_tidy$std.error <- rq2_se
rq2_tidy$statistic <- rq2_tidy$estimate / rq2_tidy$std.error
rq2_tidy$p.value <- 2 * pt(abs(rq2_tidy$statistic), df = df.residual(rq2_lm), lower.tail = FALSE)

# 95% robust CI
alpha <- 0.05
tcrit_rq2 <- qt(1 - alpha/2, df = df.residual(rq2_lm))

rq2_tidy$conf.low  <- rq2_tidy$estimate - tcrit_rq2 * rq2_tidy$std.error
rq2_tidy$conf.high <- rq2_tidy$estimate + tcrit_rq2 * rq2_tidy$std.error

#see the key rows: propwomen and interaction
rq2_tidy %>%
            filter(term %in% c("propWomen_c", "StateTX", "propWomen_c:StateTX")) %>%
                                        knitr::kable(digits = 3)


#compute simole slopes for CA and TX
#extract coefficients & robust vcov
b2 <- coef(rq2_lm)
V2 <- vcov_robust_rq2

# Indices for relevant terms
i_pw <- which(names(b2) == "propWomen_c")
i_int <- which(names(b2) == "propWomen_c:StateTX")

# Slope in CA (reference state)
slope_CA <- b2[i_pw]
se_CA <- sqrt(V2[i_pw, i_pw])
t_CA <- slope_CA / se_CA
p_CA <- 2 * pt(abs(t_CA), df = df.residual(rq2_lm), lower.tail = FALSE)
CI_CA <- slope_CA + c(-1, 1) * tcrit_rq2 * se_CA

#slope in TX = propWomen_c + interaction
slope_TX <- b2[i_pw] + b2[i_int]
var_TX <- V2[i_pw, i_pw] + V2[i_int, i_int] + 2 * V2[i_pw, i_int]
se_TX <- sqrt(var_TX)
t_TX <- slope_TX / se_TX
p_TX <- 2 * pt(abs(t_TX), df = df.residual(rq2_lm), lower.tail = FALSE)
CI_TX <- slope_TX + c(-1, 1) * tcrit_rq2 * se_TX

data.frame(State = c("CA", "TX"), Slope = c(slope_CA, slope_TX),SE_robust = c(se_CA, se_TX), t_value    = c(t_CA, t_TX), p_value = c(p_CA, p_TX), CI_low = c(CI_CA[1], CI_TX[1]), CI_high = c(CI_CA[2], CI_TX[2])) %>% knitr::kable(digits = 3)


#interaction term
rq2_tidy %>% filter(term == "propWomen_c:StateTX") %>% knitr::kable(digits = 3)



```

Use gt package for all the tabulations